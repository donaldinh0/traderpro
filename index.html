<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trader PRO</title>
    
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div id="auth-screen" class="auth-container">
        <div class="auth-box">
            <h1 class="logo">TRADER<span class="highlight">PRO</span></h1>
            
            <div id="form-login">
                <input type="email" id="email" placeholder="Seu E-mail" class="auth-input">
                <input type="password" id="password" placeholder="Sua Senha" class="auth-input">
                <button onclick="login()" class="btn-primary">ENTRAR</button>
                <p class="auth-link" onclick="toggleAuth('register')">Não tem conta? <b>Crie agora</b></p>
            </div>

            <div id="form-register" style="display:none;">
                <input type="text" id="reg-name" placeholder="Seu Nome" class="auth-input">
                <input type="text" id="reg-phone" placeholder="WhatsApp" class="auth-input">
                <input type="email" id="reg-email" placeholder="E-mail" class="auth-input">
                <input type="password" id="reg-password" placeholder="Senha" class="auth-input">
                <button onclick="cadastro()" class="btn-primary">CRIAR CONTA GRÁTIS</button>
                <p class="auth-link" onclick="toggleAuth('login')">Já tem conta? <b>Entrar</b></p>
            </div>

            <p id="msg-auth" class="msg-error"></p>
        </div>
    </div>

    <div id="app-screen" class="app-container" style="display:none;">
        
        <header class="app-header">
            <div class="user-info">
                <div class="avatar" id="avatar-initials">--</div>
                <div>
                    <h3 id="tp-user-name">Carregando...</h3>
                    <span id="tp-user-level" class="badge-level">...</span>
                </div>
            </div>
            <button onclick="logout()" class="btn-icon"><i class="ri-logout-box-r-line"></i></button>
        </header>

        <div class="score-board">
            <span class="score-label">SEU SCORE</span>
            <h1 id="dash-score">0</h1>
            <div class="score-details">
                <span>Winrate: <b id="dash-winrate">0%</b></span>
                <span>Hoje: <b id="dash-today-result">R$ 0,00</b></span>
            </div>
        </div>

        <nav class="nav-tabs">
            <button class="pill active" onclick="setTab('home')">Visão Geral</button>
            <button class="pill" onclick="setTab('calculator')">Calculadora</button>
            <button class="pill" onclick="setTab('history')">Histórico</button>
            <button class="pill" onclick="setTab('checklist')">Checklist</button>
        </nav>

        <section id="tab-home" class="panel active">
            <div class="panel-header">
                <h2><i class="ri-add-circle-line"></i> Registrar Trade</h2>
            </div>
            
            <label>Ativo Operado</label>
            <div class="input-group">
                <i class="ri-bar-chart-grouped-line"></i>
                <select id="op-asset" class="input-field" onchange="verificarAtivoDolar()">
                    <option value="WIN">Mini Índice (WIN)</option>
                    <option value="WDO">Mini Dólar (WDO)</option>
                </select>
            </div>

            <label>Resultado da Operação</label>
            <div class="result-selector">
                <button class="res-btn gain" id="btn-gain" onclick="selectType('GAIN')">GAIN</button>
                <button class="res-btn loss" id="btn-loss" onclick="selectType('LOSS')">LOSS</button>
                <button class="res-btn zero" id="btn-zero" onclick="selectType('0x0')">0x0</button>
            </div>

            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:15px; margin-bottom:5px;">
                <label id="lbl-value">Valor Financeiro (R$)</label>
                <div class="toggle-switch">
                    <button class="toggle-btn active" id="toggle-brl" onclick="setCurrency('FINANCEIRO')">R$</button>
                    <button class="toggle-btn" id="toggle-pts" onclick="setCurrency('PTS')">Pts</button>
                </div>
            </div>
            
            <div class="input-group">
                <i class="ri-money-dollar-circle-line"></i>
                <input type="text" id="op-value" class="input-field" placeholder="0,00" inputmode="numeric">
            </div>

            <p id="score-feedback" class="feedback-text">Selecione o resultado para ver a pontuação.</p>

            <button onclick="salvarOperacao()" class="btn-primary" style="margin-top:10px;">SALVAR NO DIÁRIO</button>

            <div class="recent-ops">
                <h4>Últimas Operações</h4>
                <table class="mini-table">
                    <tbody id="home-recent-list"></tbody>
                </table>
            </div>
        </section>

        <section id="tab-calculator" class="panel">
            <div class="panel-header">
                <h2><i class="ri-calculator-line"></i> Planejamento Diário</h2>
            </div>

            <div class="calc-form">
                <label>Banca Total (R$)</label>
                <div class="input-group">
                    <i class="ri-wallet-3-line"></i>
                    <input type="text" id="calc-bank" class="input-field" placeholder="R$ 0,00" inputmode="numeric">
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <div>
                        <label>Risco Dia (%)</label>
                        <div class="input-group">
                            <i class="ri-alarm-warning-line"></i> 
                            <input type="number" id="calc-risk" class="input-field" placeholder="Ex: 3">
                        </div>
                    </div>
                    
                    <div>
                        <label>Meta Dia (%)</label>
                        <div class="input-group">
                            <i class="ri-flag-2-line"></i> 
                            <input type="number" id="calc-target" class="input-field" placeholder="Ex: 5">
                        </div>
                    </div>
                </div>

                <label>Ativo Operado</label>
                <div class="asset-toggle-group" style="display:flex; gap:10px; margin-bottom:15px;">
                    <button class="toggle-btn active" id="btn-calc-win" onclick="selectCalcAsset('WIN')">Índice (WIN)</button>
                    <button class="toggle-btn" id="btn-calc-wdo" onclick="selectCalcAsset('WDO')">Dólar (WDO)</button>
                </div>

                <label>Quantos contratos vai operar?</label>
                <div class="input-group">
                    <i class="ri-file-list-3-line"></i>
                    <input type="number" id="calc-qty" class="input-field" placeholder="Ex: 1, 5, 10..." value="1">
                </div>

                <button class="btn-primary" onclick="calcularGerenciamento()">GERAR PLANO DO DIA</button>
            </div>

            <div id="calc-result-box" class="result-box" style="display:none; margin-top:20px;">
                
                <h3 style="text-align:center; color:#888; font-size:0.8rem; margin-bottom:15px; letter-spacing:1px; text-transform:uppercase;">Seus Limites Financeiros</h3>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:20px;">
                    <div style="background:rgba(231, 76, 60, 0.1); border:1px solid var(--loss); padding:15px; border-radius:10px; text-align:center;">
                        <span style="display:block; font-size:0.75rem; color:#aaa; margin-bottom:5px;">STOP LOSS (DIA)</span>
                        <strong id="res-loss-limit" style="font-size:1.5rem; color:var(--loss);">R$ 0,00</strong>
                    </div>

                    <div style="background:rgba(46, 204, 113, 0.1); border:1px solid var(--win); padding:15px; border-radius:10px; text-align:center;">
                        <span style="display:block; font-size:0.75rem; color:#aaa; margin-bottom:5px;">META GAIN (DIA)</span>
                        <strong id="res-target-val" style="font-size:1.5rem; color:var(--win);">R$ 0,00</strong>
                    </div>
                </div>

                <div style="background:#222; padding:15px; border-radius:8px; border-left: 4px solid var(--brand);">
                    <h4 style="margin:0 0 10px 0; font-size:0.9rem; color:#fff;">Capacidade Operacional</h4>
                    
                    <p style="font-size:0.85rem; color:#ccc; margin-bottom:5px;">
                        Operando com a mão fixa de <strong id="res-qty-show" style="color:#fff; font-size:1.1rem;">0</strong> contratos:
                    </p>

                    <ul style="font-size:0.85rem; color:#aaa; padding-left:20px; margin:0;">
                        <li style="margin-bottom:8px;">
                            Você pode errar até: <strong id="res-max-pts" style="color:#fff;">0 pts</strong> hoje.
                            <br><small style="color:#666;">(Antes de atingir seu stop financeiro)</small>
                        </li>
                        <li>
                            Para bater a meta, precisa de: <strong id="res-target-pts" style="color:#fff;">0 pts</strong>.
                        </li>
                    </ul>
                </div>

                <p style="margin-top:15px; font-size:0.7rem; color:#666; text-align:center;">
                    *Valores calculados para <span id="res-asset-name">WIN</span>
                </p>
            </div>
        </section>

        <section id="tab-history" class="panel">
            <div class="panel-header">
                <h2><i class="ri-history-line"></i> Diário Completo</h2>
            </div>
            <div id="daily-history-list" class="history-list">
                </div>
        </section>

        <section id="tab-checklist" class="panel">
            <div class="panel-header">
                <h2><i class="ri-checkbox-multiple-line"></i> Rotina Trader</h2>
            </div>

            <div class="checklist-card">
                <div class="check-header">
                    <h3>Pré-Market</h3>
                    <span class="status-badge pending" id="status-pre">Pendente</span>
                </div>
                <label><input type="checkbox" class="chk-pre"> Analisei o Calendário Econômico</label>
                <label><input type="checkbox" class="chk-pre"> Marquei Suportes e Resistências</label>
                <label><input type="checkbox" class="chk-pre"> Estou bem emocionalmente</label>
                <button class="btn-small" onclick="salvarChecklist('PRE')" id="btn-pre">Confirmar (+5 pts)</button>
            </div>

            <div class="checklist-card">
                <div class="check-header">
                    <h3>Pós-Market</h3>
                    <span class="status-badge pending" id="status-pos">Pendente</span>
                </div>
                <label><input type="checkbox" class="chk-pos"> Preenchi o Diário</label>
                <label><input type="checkbox" class="chk-pos"> Revisei meus erros</label>
                <button class="btn-small" onclick="salvarChecklist('POS')" id="btn-pos">Confirmar (+5 pts)</button>
            </div>
        </section>

    </div>

    <script src="script.js"></script>
</body>
</html>